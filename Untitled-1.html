<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>1νμ© μ΄λ―Έμ§€ μ•”νΈν™”κΈ°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      background: #f5f5f5;
      padding: 2rem;
    }
    input, button, textarea {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
    img {
      max-width: 100%;
      margin-top: 1rem;
      display: block;
    }
    .section {
      margin-bottom: 2rem;
    }
  </style>
</head>
<body>

  <h2>π” 1νμ© μ΄λ―Έμ§€ μ•”νΈν™”κΈ°</h2>

  <div class="section">
    <h3>β‘  μ΄λ―Έμ§€ μ—…λ΅λ“ & μ•”νΈν™”</h3>
    <input type="file" accept="image/*" id="imgInput">
    <input type="password" id="key" placeholder="μ•”νΈν‚¤ μ…λ ¥ (ν•„μ)">
    <button onclick="encryptImage()">μ•”νΈν™” & ID μƒμ„±</button>
    <div id="generatedId"></div>
  </div>

  <hr>

  <div class="section">
    <h3>β‘΅ IDλ΅ λ³µνΈν™”</h3>
    <input type="text" id="idInput" placeholder="μ•”νΈν™”λ ID μ…λ ¥">
    <input type="password" id="decryptKey" placeholder="μ•”νΈν‚¤ μ…λ ¥">
    <button onclick="decryptImage()">λ³µνΈν™” & μ΄λ―Έμ§€ λ³΄κΈ°</button>
    <div id="imagePreview"></div>
  </div>

  <script>
    function generateId(length = 8) {
      return Math.random().toString(36).substr(2, length);
    }

    function encryptImage() {
      const file = document.getElementById('imgInput').files[0];
      const key = document.getElementById('key').value;
      const idDisplay = document.getElementById('generatedId');
      if (!file || !key) return alert("μ΄λ―Έμ§€μ™€ μ•”νΈν‚¤λ¥Ό λ¨λ‘ μ…λ ¥ν•μ„Έμ”.");

      const reader = new FileReader();
      reader.onload = function (e) {
        const base64 = e.target.result;
        const ciphertext = CryptoJS.AES.encrypt(base64, key).toString();
        const id = generateId();
        localStorage.setItem(id, ciphertext);
        idDisplay.innerHTML = `<p>π”‘ κ³µμ ν•  ID: <strong>${id}</strong></p>`;
      };
      reader.readAsDataURL(file);
    }

    function decryptImage() {
      const id = document.getElementById('idInput').value.trim();
      const key = document.getElementById('decryptKey').value;
      const preview = document.getElementById('imagePreview');

      if (!id || !key) return alert("IDμ™€ μ•”νΈν‚¤λ¥Ό λ¨λ‘ μ…λ ¥ν•μ„Έμ”.");

      const ciphertext = localStorage.getItem(id);
      if (!ciphertext) return alert("μ ν¨ν•μ§€ μ•μ€ IDμ…λ‹λ‹¤.");

      try {
        const bytes = CryptoJS.AES.decrypt(ciphertext, key);
        const decrypted = bytes.toString(CryptoJS.enc.Utf8);

        if (!decrypted.startsWith("data:image")) throw new Error();

        const img = new Image();
        img.src = decrypted;
        preview.innerHTML = '';
        preview.appendChild(img);

        // 1ν μ—΄λ ν›„ λ°μ΄ν„° μ‚­μ 
        localStorage.removeItem(id);
        document.getElementById('idInput').value = '';
        document.getElementById('decryptKey').value = '';
        alert("π”“ μ΄λ―Έμ§€ λ³µνΈν™” μ™„λ£ (1νμ©). λ‹¤μ‹ μ—΄λν•  μ μ—†μµλ‹λ‹¤.");
      } catch (err) {
        alert("β λ³µνΈν™” μ‹¤ν¨: μ•”νΈν‚¤κ°€ ν‹€λ¦¬κ±°λ‚ μλ»λ IDμ…λ‹λ‹¤.");
      }
    }
  </script>
</body>
</html>
